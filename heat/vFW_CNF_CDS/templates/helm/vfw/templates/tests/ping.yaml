# Copyright Â© 2021 Samsung Electronics
# All rights reserved. This program and the accompanying materials
# are made available under the terms of the Apache License, Version 2.0
# which accompanies this distribution, and is available at
# http://www.apache.org/licenses/LICENSE-2.0
{{ if eq .Values.Tests.enabled "yes" }}
---
apiVersion: v1
kind: Pod
metadata:
  name: "{{ .Values.vfw_name_0 }}-test"
  labels:
    vnf-name: {{ .Values.vnf_name }}
    vf-module-name: {{ .Values.vfw_name_0 }}
    release: {{ .Release.Name }}
    chart: {{ .Chart.Name }}
  annotations:
    "helm.sh/hook": test-success
    k8s.v1.cni.cncf.io/networks: "{{ .Values.net_attachment_definition }}"
    k8s.plugin.opnfv.org/nfn-network: |
        { "type": "ovn4nfv",
          "interface": [
            {
              "name": {{ .Values.int_private1_net_id | quote }},
              "interface": "ethtest1" ,
              "defaultGateway": "false"
            }
            {
              "name": {{ .Values.int_private2_net_id | quote }},
              "interface": "ethtest2" ,
              "defaultGateway": "false"
            }
          ]
        }
spec:
  restartPolicy: Never
  containers:
    - name: "ping-test-private1-net"
      image: busybox
      command:
        - /bin/sh
        - -exc
        - "ping -c {{ .Values.Tests.ping_count }} -I ethtest1 {{ .Values.vfw_int_private1_ip_0 }}"
    - name: "ping-test-private2-net"
      image: busybox
      command:
        - /bin/sh
        - -exc
        - "ping -c {{ .Values.Tests.ping_count }} -I ethtest2 {{ .Values.vfw_int_private2_ip_0 }}"
{{- end }}
